<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mac 命令大全 · 可搜索/分类/常用</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#121832; --panel2:#0f1530; --muted:#8aa0ff; --text:#e6eaff; --chip:#1b2450; --brand:#5b7cff; --ok:#22c55e; --warn:#f59e0b;
      --border:#243067; --shadow:0 8px 30px rgba(3,10,30,.45)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;color:var(--text);background:linear-gradient(120deg,#0a0f26,#0a0d1c 40%,#0f1636)}
    .container{max-width:1180px;margin:24px auto;padding:0 16px}
    .app{display:grid;grid-template-columns:260px 1fr;gap:16px}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow)}
    .header{padding:18px 18px 10px}
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    .sub{opacity:.75;font-size:13px;margin-top:6px}

    .search{display:flex;gap:8px;padding:12px;border-top:1px solid var(--border);border-bottom:1px solid var(--border);background:rgba(17,24,56,.35);backdrop-filter:blur(6px)}
    .search input{flex:1;background:#0b1230;border:1px solid var(--border);color:var(--text);padding:12px 12px;border-radius:12px;outline:none}
    .search input::placeholder{color:#9fb2ff80}
    .search .btn{background:var(--brand);border:none;color:white;padding:0 14px;border-radius:12px;cursor:pointer}
    .search .ghost{background:#152157;border:1px solid var(--border);color:var(--muted)}

    .sidebar{padding:12px}
    .cat{display:flex;align-items:center;gap:8px;padding:8px 10px;margin:6px 0;border-radius:10px;color:#cfe1ff;cursor:pointer;border:1px solid transparent}
    .cat:hover{background:#0e1740}
    .cat.active{background:linear-gradient(180deg,#17215a,#10194a);border-color:#29408f}
    .chip{font-size:12px;padding:2px 8px;border-radius:999px;background:var(--chip);border:1px solid var(--border);color:#b9c8ff}

    .toolbar{display:flex;gap:8px;align-items:center;padding:12px;border-bottom:1px solid var(--border)}
    .toolbar .btn{background:#16204f;color:#cfe1ff;border:1px solid var(--border);padding:8px 12px;border-radius:10px;cursor:pointer}
    .toolbar .btn.active{background:var(--brand);color:white}

    .list{padding:8px}
    .item{display:grid;grid-template-columns:1fr auto;gap:10px;margin:10px 0;padding:12px;border-radius:14px;background:linear-gradient(180deg,#11183c,#0d1433);border:1px solid var(--border)}
    .cmd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:13px}
    .title{font-weight:700}
    .desc{opacity:.9;margin-top:6px}
    .meta{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
    .badge{font-size:11px;padding:3px 8px;border-radius:999px;background:#0c1336;border:1px solid #243067;color:#b2c3ff}

    .actions{display:flex;align-items:center;gap:8px}
    .small{font-size:12px;opacity:.85}
    .muted{opacity:.7}
    .copy{background:#16204f;border:1px solid var(--border);color:#dfe7ff;border-radius:10px;padding:8px 10px;cursor:pointer}
    .fav{background:#10194a;border:1px solid var(--border);color:#ffdd80;border-radius:10px;padding:8px 10px;cursor:pointer}

    .footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;opacity:.85}
    .kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:#0c1336;border:1px solid #25336b;padding:2px 6px;border-radius:6px}

    .empty{opacity:.7;text-align:center;padding:28px}
    .category-title{padding:16px 16px 0;font-size:14px;opacity:.85}
    .counter{margin-left:auto;opacity:.7}
    @media (max-width: 880px){.app{grid-template-columns:1fr}.sidebar{order:2}.main{order:1}}
    .search-top { display: none; margin-bottom: 12px; }
    @media (max-width: 880px){
      .search-side { display: none !important; }
      .search-top { display: flex !important; }
      .app { grid-template-columns:1fr; }
      .sidebar { order:2; }
      .main { order:1; }
    }
  </style>
</head>
<body>
<div class="container">
  <!-- 新增：顶部搜索区（仅手机端显示） -->
  <div class="search search-top" id="searchTop">
    <input id="q-top" placeholder="搜索命令、描述或标签…（快捷键 / ）" />
    <button class="btn ghost" id="clearBtnTop">清除</button>
  </div>
  <div class="app">
    <aside class="card sidebar" id="sidebar">
      <div class="header">
        <h1>Mac 命令大全</h1>
        <div class="sub">支持 <span class="kbd">全局搜索</span>、<span class="kbd">分类</span>、<span class="kbd">常用收藏</span>、<span class="kbd">复制</span>。</div>
      </div>
      <!-- 仅桌面端显示的搜索区 -->
      <div class="search search-side" id="searchSide">
        <input id="q" placeholder="搜索命令、描述或标签…（快捷键 / ）" />
        <button class="btn ghost" id="clearBtn">清除</button>
      </div>
      <div class="category-title">分类</div>
      <div id="cats"></div>
      <div class="footer small">
        <div>提示：按 <span class="kbd">/</span> 聚焦搜索；按 <span class="kbd">c</span> 复制选中项；按 <span class="kbd">f</span> 收藏/取消</div>
      </div>
    </aside>

    <main class="card main" id="main">
      <div class="toolbar">
        <button class="btn active" data-view="all">全部</button>
        <button class="btn" data-view="fav">常用</button>
        <button class="btn" id="exportFav">导出常用为 Markdown</button>
        <span class="counter small" id="counter"></span>
      </div>
      <div class="list" id="list"></div>
      <div class="footer small">
        <span class="muted">本页面为单文件离线可用。数据保存在浏览器本地 <span class="kbd">localStorage</span>。</span>
        <span class="muted">© 2025 Mac 命令速查</span>
      </div>
    </main>
  </div>
</div>

<script>
// —— 数据区：命令条目 ——
/** 每个条目：
 * { id, cmd, syntax, category, desc, tags:[...], example?:"" }
 * category 取值：文件与目录/磁盘与文件系统/权限与用户/文本处理/查找与搜索/网络/进程与服务/系统信息/包管理-Homebrew/压缩归档/开发环境/SSH&安全/Git/Hexo/macOS特有/其它
 */
const DATA = [
  // 文件与目录
  {id:'pwd', cmd:'pwd', syntax:'pwd', category:'文件与目录', desc:'显示当前工作目录的绝对路径。', tags:['路径','目录']},
  {id:'ls', cmd:'ls', syntax:'ls -lha', category:'文件与目录', desc:'列出目录内容：-l 详细，-h 人类可读，-a 显示隐藏文件。', tags:['列表','隐藏','权限']},
  {id:'cd', cmd:'cd', syntax:'cd ~/Documents', category:'文件与目录', desc:'切换目录；cd ~ 回到用户主目录，cd - 返回上次位置。', tags:['切换','目录']},
  {id:'mkdir', cmd:'mkdir', syntax:'mkdir -p project/src', category:'文件与目录', desc:'创建目录；-p 递归创建多级目录。', tags:['创建','目录']},
  {id:'touch', cmd:'touch', syntax:'touch notes.txt', category:'文件与目录', desc:'创建空文件或更新文件时间戳。', tags:['文件','新建']},
  {id:'rm', cmd:'rm', syntax:'rm -rf build/', category:'文件与目录', desc:'删除文件/目录；-r 递归，-f 强制。慎用！', tags:['删除','危险']},
  {id:'cp', cmd:'cp', syntax:'cp -R src/ dst/', category:'文件与目录', desc:'复制文件或目录；-R 递归复制目录。', tags:['复制']},
  {id:'mv', cmd:'mv', syntax:'mv old.txt new.txt', category:'文件与目录', desc:'移动/重命名文件或目录。', tags:['移动','重命名']},
  {id:'open', cmd:'open', syntax:'open .', category:'文件与目录', desc:'用 Finder/默认应用打开文件或目录；open . 打开当前目录。', tags:['Finder','打开','macOS']},
  {id:'open-app', cmd:'open -a', syntax:'open -a "Visual Studio Code" .', category:'文件与目录', desc:'使用指定应用打开目标路径。', tags:['应用','打开','macOS']},
  {id:'pbcopy', cmd:'pbcopy | pbpaste', syntax:'cat id_rsa.pub | pbcopy', category:'文件与目录', desc:'与剪贴板交互：pbcopy 复制输入，pbpaste 粘贴输出。', tags:['剪贴板','macOS']},

  // 磁盘与文件系统
  {id:'df', cmd:'df', syntax:'df -h', category:'磁盘与文件系统', desc:'查看磁盘使用情况（-h 人类可读）。', tags:['磁盘','空间']},
  {id:'du', cmd:'du', syntax:'du -sh *', category:'磁盘与文件系统', desc:'统计当前各文件/目录大小；-s 汇总，-h 人类可读。', tags:['大小','统计']},
  {id:'diskutil', cmd:'diskutil', syntax:'diskutil list', category:'磁盘与文件系统', desc:'列出磁盘/分区；可做挂载/抹盘等（慎用）。', tags:['磁盘','macOS','分区']},
  {id:'mount', cmd:'mount', syntax:'mount', category:'磁盘与文件系统', desc:'显示已挂载的文件系统。', tags:['挂载']},
  {id:'hdiutil', cmd:'hdiutil', syntax:'hdiutil attach xxx.dmg', category:'磁盘与文件系统', desc:'挂载/创建镜像 dmg/iso。', tags:['镜像','dmg','macOS']},

  // 权限与用户
  {id:'sudo', cmd:'sudo', syntax:'sudo command', category:'权限与用户', desc:'以管理员权限执行命令。', tags:['管理员','权限']},
  {id:'chown', cmd:'chown', syntax:'sudo chown -R $USER:staff ~/Documents', category:'权限与用户', desc:'修改所有者/用户组；-R 递归。', tags:['所有者','权限']},
  {id:'chmod', cmd:'chmod', syntax:'chmod -R 755 folder', category:'权限与用户', desc:'修改权限；示例 755 表示 rwx r-x r-x。', tags:['权限','可执行']},
  {id:'whoami', cmd:'whoami', syntax:'whoami', category:'权限与用户', desc:'显示当前用户名。', tags:['用户']},
  {id:'id', cmd:'id', syntax:'id -a', category:'权限与用户', desc:'显示用户与组信息。', tags:['用户','组']},
  {id:'dscl', cmd:'dscl', syntax:'dscl . -read /Users/$USER', category:'权限与用户', desc:'目录服务命令，读取本地账户属性。', tags:['账户','macOS']},
  {id:'xattr', cmd:'xattr', syntax:'xattr -cr /Applications/App.app', category:'权限与用户', desc:'管理扩展属性；-c 清除，-r 递归，多用于移除隔离标记。', tags:['隔离','权限','macOS']},

  // 文本处理
  {id:'cat', cmd:'cat', syntax:'cat file.txt', category:'文本处理', desc:'打印文件内容到标准输出。', tags:['查看']},
  {id:'tac', cmd:'tac', syntax:'tac file.txt', category:'文本处理', desc:'反向打印（某些系统需安装 coreutils）。', tags:['反向','coreutils']},
  {id:'head', cmd:'head', syntax:'head -n 20 file.log', category:'文本处理', desc:'查看前 N 行。', tags:['前N行']},
  {id:'tail', cmd:'tail', syntax:'tail -f app.log', category:'文本处理', desc:'查看末尾；-f 跟随实时输出。', tags:['日志','跟随']},
  {id:'less', cmd:'less', syntax:'less file.txt', category:'文本处理', desc:'分页查看，支持搜索 /pattern。', tags:['分页']},
  {id:'grep', cmd:'grep', syntax:'grep -R "keyword" .', category:'文本处理', desc:'按模式匹配文本；-R 递归目录；-i 忽略大小写。', tags:['搜索','正则']},
  {id:'awk', cmd:'awk', syntax:'awk -F, \'{print $1,$3}\' data.csv', category:'文本处理', desc:'按列处理文本的利器。', tags:['列','处理']},
  {id:'sed', cmd:'sed', syntax:"sed -i '' 's/old/new/g' file.txt", category:'文本处理', desc:'流编辑器；macOS BSD sed 的原地替换需带空引号。', tags:['替换','BSD']},
  {id:'sort', cmd:'sort', syntax:'sort -nr file.txt', category:'文本处理', desc:'排序；-n 按数值，-r 逆序。', tags:['排序']},
  {id:'uniq', cmd:'uniq', syntax:'sort file.txt | uniq -c', category:'文本处理', desc:'去重；常与 sort 配合，-c 统计次数。', tags:['去重','统计']},
  {id:'tr', cmd:'tr', syntax:"tr 'a-z' 'A-Z' < file.txt", category:'文本处理', desc:'字符替换/删除/合并。', tags:['替换','大小写']},
  {id:'wc', cmd:'wc', syntax:'wc -l file.txt', category:'文本处理', desc:'统计行/词/字节数。', tags:['统计']},
  {id:'cut', cmd:'cut', syntax:'cut -d: -f1 /etc/passwd', category:'文本处理', desc:'按分隔符切列提取。', tags:['提取','列']},
  {id:'paste', cmd:'paste', syntax:'paste -d, a.txt b.txt', category:'文本处理', desc:'按列合并文件。', tags:['合并','列']},
  {id:'jq', cmd:'jq', syntax:'cat data.json | jq .items[0]', category:'文本处理', desc:'命令行 JSON 处理（需 brew 安装 jq）。', tags:['JSON','jq']},

  // 查找与搜索
  {id:'find', cmd:'find', syntax:'find . -name "*.md"', category:'查找与搜索', desc:'按条件查找文件；-type f 只文件，-maxdepth 限深。', tags:['查找']},
  {id:'fd', cmd:'fd', syntax:'fd pattern src/', category:'查找与搜索', desc:'更快更友好的查找（需 brew 安装 fd）。', tags:['fd','查找']},
  {id:'locate', cmd:'locate', syntax:'locate filename', category:'查找与搜索', desc:'通过数据库快速定位（首次需 sudo /usr/libexec/locate.updatedb）。', tags:['定位','数据库']},
  {id:'rg', cmd:'ripgrep', syntax:'rg -n "keyword"', category:'查找与搜索', desc:'极速全文搜索 ripgrep（需 brew 安装 ripgrep）。', tags:['ripgrep','全文']},

  // 网络
  {id:'ifconfig', cmd:'ifconfig', syntax:'ifconfig', category:'网络', desc:'查看网络接口与 IP（macOS 自带）。', tags:['IP','接口','macOS']},
  {id:'ip', cmd:'ip', syntax:'ip addr', category:'网络', desc:'Linux 常用 ip 工具（mac 上可通过 iproute2mac 提供）。', tags:['IP','Linux']},
  {id:'ping', cmd:'ping', syntax:'ping -c 4 8.8.8.8', category:'网络', desc:'测试连通性；-c 发送次数。', tags:['连通','测试']},
  {id:'traceroute', cmd:'traceroute', syntax:'traceroute google.com', category:'网络', desc:'路由跟踪（若无可用 brew 安装）。', tags:['路由']},
  {id:'curl', cmd:'curl', syntax:'curl -I https://example.com', category:'网络', desc:'发送 HTTP 请求；-I 仅请求头；-L 跟随跳转。', tags:['HTTP','下载']},
  {id:'wget', cmd:'wget', syntax:'wget -c URL', category:'网络', desc:'下载工具（需 brew 安装 wget）。', tags:['下载']},
  {id:'nc', cmd:'nc', syntax:'nc -vz host 80', category:'网络', desc:'netcat：端口扫描/端口测试/转发。', tags:['端口','扫描']},
  {id:'ssh', cmd:'ssh', syntax:'ssh user@host -p 22', category:'网络', desc:'远程连接；配合密钥认证更安全。', tags:['远程','登录']},
  {id:'scp', cmd:'scp', syntax:'scp file user@host:/path', category:'网络', desc:'通过 SSH 复制文件。', tags:['复制','远程']},
  {id:'sftp', cmd:'sftp', syntax:'sftp user@host', category:'网络', desc:'基于 SSH 的文件传输。', tags:['传输','远程']},
  {id:'networksetup', cmd:'networksetup', syntax:'networksetup -listallhardwareports', category:'网络', desc:'macOS 网络配置命令行。', tags:['macOS','网络设置']},

  // 进程与服务
  {id:'ps', cmd:'ps', syntax:'ps aux | grep app', category:'进程与服务', desc:'查看进程列表。', tags:['进程']},
  {id:'top', cmd:'top', syntax:'top -o cpu', category:'进程与服务', desc:'实时系统监控；-o cpu 按 CPU 排序。', tags:['监控']},
  {id:'htop', cmd:'htop', syntax:'htop', category:'进程与服务', desc:'更友好的 top（需 brew 安装 htop）。', tags:['监控','交互']},
  {id:'kill', cmd:'kill', syntax:'kill -9 PID', category:'进程与服务', desc:'向进程发送信号；-9 为强制终止（慎用）。', tags:['终止']},
  {id:'pkill', cmd:'pkill', syntax:'pkill -f "node app.js"', category:'进程与服务', desc:'按名称/模式杀进程。', tags:['结束']},
  {id:'launchctl', cmd:'launchctl', syntax:'launchctl list', category:'进程与服务', desc:'管理 LaunchDaemons/Agents（macOS 服务）。', tags:['服务','macOS']},
  {id:'brew-services', cmd:'brew services', syntax:'brew services start nginx', category:'进程与服务', desc:'Homebrew 服务管理（需 brew services）。', tags:['服务','brew']},

  // 系统信息
  {id:'sw_vers', cmd:'sw_vers', syntax:'sw_vers', category:'系统信息', desc:'显示 macOS 版本信息。', tags:['版本','macOS']},
  {id:'system_profiler', cmd:'system_profiler', syntax:'system_profiler SPHardwareDataType', category:'系统信息', desc:'系统硬件/软件详参。', tags:['硬件','软件']},
  {id:'uname', cmd:'uname', syntax:'uname -a', category:'系统信息', desc:'显示内核与系统信息。', tags:['内核']},
  {id:'uptime', cmd:'uptime', syntax:'uptime', category:'系统信息', desc:'系统运行时间与平均负载。', tags:['负载']},
  {id:'pmset', cmd:'pmset', syntax:'pmset -g batt', category:'系统信息', desc:'电源管理设置/电量查看。', tags:['电源','macOS']},
  {id:'spctl', cmd:'spctl', syntax:'spctl --status', category:'系统信息', desc:'Gatekeeper 控制与签名校验。', tags:['安全','签名','macOS']},

  // 包管理 - Homebrew
  {id:'brew-install', cmd:'brew install', syntax:'brew install wget', category:'包管理-Homebrew', desc:'安装软件包。', tags:['安装','brew']},
  {id:'brew-update', cmd:'brew update && brew upgrade', syntax:'brew update && brew upgrade', category:'包管理-Homebrew', desc:'更新索引并升级已安装包。', tags:['更新','升级']},
  {id:'brew-search', cmd:'brew search', syntax:'brew search node', category:'包管理-Homebrew', desc:'搜索可用包。', tags:['搜索','brew']},
  {id:'brew-info', cmd:'brew info', syntax:'brew info ffmpeg', category:'包管理-Homebrew', desc:'查看包信息。', tags:['信息']},
  {id:'brew-list', cmd:'brew list', syntax:'brew list --versions', category:'包管理-Homebrew', desc:'列出已安装包及其版本。', tags:['已安装']},
  {id:'brew-uninstall', cmd:'brew uninstall', syntax:'brew uninstall jq', category:'包管理-Homebrew', desc:'卸载包。', tags:['卸载']},
  {id:'brew-clean', cmd:'brew cleanup', syntax:'brew cleanup', category:'包管理-Homebrew', desc:'清理旧版本与缓存。', tags:['清理']},

  // 压缩与归档
  {id:'zip', cmd:'zip', syntax:'zip -r archive.zip folder', category:'压缩归档', desc:'压缩为 zip；-r 递归。', tags:['压缩','zip']},
  {id:'unzip', cmd:'unzip', syntax:'unzip archive.zip -d out', category:'压缩归档', desc:'解压 zip 到指定目录。', tags:['解压']},
  {id:'tar', cmd:'tar', syntax:'tar -czvf a.tar.gz folder', category:'压缩归档', desc:'创建/解包 tar；-c 创建 -x 解包 -z gzip。', tags:['tar','gzip']},
  {id:'gz', cmd:'gzip/gunzip', syntax:'gzip file && gunzip file.gz', category:'压缩归档', desc:'gzip 压缩与解压。', tags:['gzip']},

  // 开发环境
  {id:'xcode-select', cmd:'xcode-select', syntax:'xcode-select --install', category:'开发环境', desc:'安装命令行工具（clang/git 等）。', tags:['Xcode','编译','macOS']},
  {id:'python', cmd:'python / python3', syntax:'python3 --version', category:'开发环境', desc:'Python 运行时与包管理（pip）。', tags:['Python']},
  {id:'node', cmd:'node / npm / nvm', syntax:'nvm install --lts && node -v', category:'开发环境', desc:'Node.js 与版本管理。', tags:['Node','npm','nvm']},
  {id:'java', cmd:'java / javac', syntax:'java -version', category:'开发环境', desc:'Java 运行时/编译器。', tags:['Java']},
  {id:'ruby', cmd:'ruby / gem', syntax:'ruby -v && gem -v', category:'开发环境', desc:'Ruby 与包管理器 gem。', tags:['Ruby']},
  {id:'go', cmd:'go', syntax:'go version', category:'开发环境', desc:'Go 语言工具链。', tags:['Go']},
  {id:'pip', cmd:'pip / pip3', syntax:'python3 -m pip install package', category:'开发环境', desc:'Python 包管理最佳实践。', tags:['pip','Python']},

  // SSH & 安全
  {id:'ssh-keygen', cmd:'ssh-keygen', syntax:'ssh-keygen -t ed25519 -C "you@example.com"', category:'SSH&安全', desc:'生成 SSH 密钥（推荐 ed25519）。', tags:['密钥','SSH']},
  {id:'ssh-add', cmd:'ssh-add', syntax:'ssh-add -K ~/.ssh/id_ed25519', category:'SSH&安全', desc:'添加密钥到钥匙串；-K 保存到 macOS 钥匙串。', tags:['钥匙串','macOS']},
  {id:'ssh-config', cmd:'~/.ssh/config', syntax:'Host github.com\n  HostName github.com\n  User git\n  IdentityFile ~/.ssh/id_ed25519', category:'SSH&安全', desc:'多账户/别名登录配置。', tags:['配置','多账户']},
  {id:'chmod-key', cmd:'chmod (密钥权限)', syntax:'chmod 600 ~/.ssh/id_ed25519', category:'SSH&安全', desc:'修正私钥权限（过宽会被拒绝）。', tags:['权限','SSH']},

  // Git
  {id:'git-init', cmd:'git init', syntax:'git init', category:'Git', desc:'初始化本地仓库。', tags:['初始化']},
  {id:'git-config', cmd:'git config', syntax:'git config --global user.name "Your Name"', category:'Git', desc:'设置用户名/邮箱/编辑器等。', tags:['配置']},
  {id:'git-remote', cmd:'git remote', syntax:'git remote add origin git@github.com:user/repo.git', category:'Git', desc:'添加远程仓库。', tags:['远程']},
  {id:'git-add', cmd:'git add', syntax:'git add .', category:'Git', desc:'将改动加入暂存区。', tags:['暂存']},
  {id:'git-commit', cmd:'git commit', syntax:'git commit -m "feat: init"', category:'Git', desc:'提交更改。', tags:['提交']},
  {id:'git-branch', cmd:'git branch', syntax:'git branch -M main', category:'Git', desc:'创建/重命名/查看分支。', tags:['分支']},
  {id:'git-push', cmd:'git push', syntax:'git push -u origin main', category:'Git', desc:'推送到远程；-u 设为上游。', tags:['推送']},
  {id:'git-pull', cmd:'git pull', syntax:'git pull --rebase', category:'Git', desc:'拉取并整合更改。', tags:['拉取']},
  {id:'git-clone', cmd:'git clone', syntax:'git clone git@github.com:user/repo.git', category:'Git', desc:'克隆远程仓库。', tags:['克隆']},
  {id:'git-status', cmd:'git status', syntax:'git status -sb', category:'Git', desc:'查看状态（简洁模式 -sb）。', tags:['状态']},
  {id:'git-log', cmd:'git log', syntax:'git log --oneline --graph --decorate --all', category:'Git', desc:'查看提交历史。', tags:['历史','日志']},
  {id:'git-stash', cmd:'git stash', syntax:'git stash push -m "wip"', category:'Git', desc:'暂存未提交改动。', tags:['暂存']},
  {id:'git-reset', cmd:'git reset', syntax:'git reset --hard HEAD~1', category:'Git', desc:'回退到上一个提交（危险）。', tags:['回退','危险']},
  {id:'git-revert', cmd:'git revert', syntax:'git revert <commit>', category:'Git', desc:'生成反向提交以撤销更改。', tags:['撤销']},
  {id:'git-tag', cmd:'git tag', syntax:'git tag v1.0.0 && git push origin --tags', category:'Git', desc:'打标签并推送。', tags:['标签']},

  // Hexo（博客）
  {id:'npm-hexo', cmd:'npm i -g hexo-cli', syntax:'npm i -g hexo-cli', category:'Hexo', desc:'安装 Hexo 命令行工具。', tags:['Hexo','安装']},
  {id:'hexo-init', cmd:'hexo init', syntax:'hexo init blog && cd blog && npm i', category:'Hexo', desc:'初始化博客工程。', tags:['初始化']},
  {id:'hexo-new', cmd:'hexo new', syntax:'hexo new "我的第一篇"', category:'Hexo', desc:'新建文章/页面。', tags:['新建']},
  {id:'hexo-g', cmd:'hexo generate', syntax:'hexo g', category:'Hexo', desc:'生成静态页面。', tags:['生成']},
  {id:'hexo-s', cmd:'hexo server', syntax:'hexo s -p 4000', category:'Hexo', desc:'本地预览服务。', tags:['预览','本地']},
  {id:'hexo-d', cmd:'hexo deploy', syntax:'hexo d', category:'Hexo', desc:'部署到远端（需 _config.yml 设置 deploy）。', tags:['部署']},

  // macOS 特有
  {id:'defaults', cmd:'defaults', syntax:'defaults write -g ApplePressAndHoldEnabled -bool false', category:'macOS特有', desc:'读写偏好设置（慎用）。', tags:['偏好','macOS']},
  {id:'osascript', cmd:'osascript', syntax:'osascript -e "display notification \"Hi\" with title \"Hello\""', category:'macOS特有', desc:'运行 AppleScript/JS for Automation。', tags:['通知','AppleScript']},
  {id:'mdfind', cmd:'mdfind', syntax:'mdfind "kMDItemFSName == \"*.pdf\""', category:'macOS特有', desc:'Spotlight 元数据搜索。', tags:['Spotlight','搜索']},
  {id:'mdutil', cmd:'mdutil', syntax:'sudo mdutil -E /', category:'macOS特有', desc:'管理 Spotlight 索引。', tags:['索引','Spotlight']},
  {id:'screencapture', cmd:'screencapture', syntax:'screencapture -i ~/Desktop/cap.png', category:'macOS特有', desc:'截图/录屏命令；-i 交互选择。', tags:['截图']},
  {id:'say', cmd:'say', syntax:'say "你好，世界" -r 180 -v Ting-Ting', category:'macOS特有', desc:'系统语音合成朗读。', tags:['TTS','朗读']},
  {id:'brew-cask', cmd:'brew install --cask', syntax:'brew install --cask iterm2', category:'macOS特有', desc:'安装 GUI 应用（cask）。', tags:['GUI','brew']},

  // 其它常用
  {id:'date', cmd:'date', syntax:'date "+%Y-%m-%d %H:%M:%S"', category:'其它', desc:'显示/格式化时间。', tags:['时间']},
  {id:'cal', cmd:'cal', syntax:'cal 8 2025', category:'其它', desc:'显示日历。', tags:['日历']},
  {id:'pbzip2', cmd:'bzip2/bunzip2', syntax:'bzip2 file && bunzip2 file.bz2', category:'压缩归档', desc:'bzip2 压缩/解压。', tags:['压缩']},
  {id:'uname-sysctl', cmd:'sysctl', syntax:'sysctl -a | grep machdep.cpu', category:'系统信息', desc:'查询内核/硬件内核参数。', tags:['内核','CPU']},
];

// —— 分类列表（显示顺序） ——
const CATEGORIES = [
  '全部',
  '常用',
  '文件与目录',
  '磁盘与文件系统',
  '权限与用户',
  '文本处理',
  '查找与搜索',
  '网络',
  '进程与服务',
  '系统信息',
  '包管理-Homebrew',
  '压缩归档',
  '开发环境',
  'SSH&安全',
  'Git',
  'Hexo',
  'macOS特有',
  '其它'
];

// —— 状态与存储 ——
const store = {
  get fav(){ try{return new Set(JSON.parse(localStorage.getItem('favCmds')||'[]'))}catch{ return new Set() } },
  set favSet(set){ localStorage.setItem('favCmds', JSON.stringify(Array.from(set))) },
}

let state = { q:'', category:'全部', view:'all', fav: store.fav };

// —— DOM 引用 ——
const $q = document.getElementById('q');
const $list = document.getElementById('list');
const $cats = document.getElementById('cats');
const $counter = document.getElementById('counter');

// —— 渲染分类侧栏 ——
function renderCats(){
  $cats.innerHTML = '';
  CATEGORIES.forEach(cat=>{
    if(cat==='全部' || cat==='常用') return; // 顶部工具栏已有
    const el = document.createElement('div');
    el.className = 'cat'+(state.category===cat?' active':'');
    el.innerHTML = `<span>${cat}</span><span class="chip">${DATA.filter(x=>x.category===cat).length}</span>`;
    el.onclick = ()=>{ state.category = cat; setActiveView('all'); render(); };
    $cats.appendChild(el);
  });
}

// —— 过滤逻辑 ——
function filterData(){
  let items = DATA.slice();
  if(state.category !== '全部'){
    items = items.filter(x=>x.category===state.category);
  }
  if(state.view==='fav'){
    items = items.filter(x=>state.fav.has(x.id));
  }
  if(state.q.trim()){
    const kw = state.q.trim().toLowerCase();
    items = items.filter(x=>
      (x.cmd+" "+x.syntax+" "+x.desc+" "+x.tags.join(' ')).toLowerCase().includes(kw)
    );
  }
  return items;
}

// —— 渲染列表 ——
function render(){
  const items = filterData();
  $list.innerHTML = '';
  if(items.length===0){ $list.innerHTML = `<div class='empty'>没有匹配的结果。换一个关键词试试～</div>`; }
  items.forEach((x,i)=>{
    const isFav = state.fav.has(x.id);
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <div>
        <div class="title cmd">${x.cmd}</div>
        <div class="desc">${x.desc}</div>
        <div class="meta">
          <span class="badge">语法：<span class="cmd">${escapeHTML(x.syntax)}</span></span>
          <span class="badge">分类：${x.category}</span>
          ${x.tags.map(t=>`<span class='badge'>#${t}</span>`).join('')}
        </div>
      </div>
      <div class="actions">
        <button class="copy" title="复制语法" data-idx="${x.id}">复制</button>
        <button class="fav" title="加入常用" data-idx="${x.id}">${isFav?'★ 已收藏':'☆ 常用'}</button>
      </div>
    `;
    $list.appendChild(el);
  });
  $counter.textContent = `共 ${items.length} 条 · 收藏 ${state.fav.size} 条`;

  // 绑定动作
  $list.querySelectorAll('.copy').forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute('data-idx');
      const item = DATA.find(d=>d.id===id);
      navigator.clipboard.writeText(item.syntax).then(()=>{
        flash(btn, '已复制');
      });
    }
  });
  $list.querySelectorAll('.fav').forEach(btn=>{
    btn.onclick = ()=>{
      const id = btn.getAttribute('data-idx');
      toggleFav(id); render();
    }
  });
}

function toggleFav(id){
  const fav = state.fav;
  if(fav.has(id)) fav.delete(id); else fav.add(id);
  store.favSet = fav; // 持久化
}

function setActiveView(v){
  state.view = v;
  document.querySelectorAll('.toolbar .btn').forEach(b=>{
    if(b.dataset.view){ b.classList.toggle('active', b.dataset.view===v); }
  });
}

function escapeHTML(str){
  return String(str).replace(/[&<>"']/g, s=>({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'
  })[s]);
}

function flash(el, text){
  const old = el.textContent; el.textContent = text; el.disabled = true;
  setTimeout(()=>{el.textContent = old; el.disabled = false;}, 900);
}

// —— 事件绑定 ——
$q.addEventListener('input', ()=>{ state.q = $q.value; render(); });

document.getElementById('clearBtn').onclick = ()=>{ $q.value=''; state.q=''; render(); };

document.querySelectorAll('.toolbar .btn[data-view]').forEach(btn=>{
  btn.onclick = ()=>{ setActiveView(btn.dataset.view); render(); }
});

document.getElementById('exportFav').onclick = ()=>{
  const ids = Array.from(state.fav);
  const items = DATA.filter(x=>ids.includes(x.id));
  const md = ['# 我的常用 Mac 命令', '', ...items.map(x=>`- **${x.cmd}** — ${x.desc}\n\n  语法：\`${x.syntax}\`\n  分类：${x.category}\n  标签：${x.tags.map(t=>'`'+t+'`').join(' ')}\n`)].join('\n');
  const blob = new Blob([md], {type:'text/markdown'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = '我的常用Mac命令.md'; a.click();
  URL.revokeObjectURL(url);
};

// 新增：顶部搜索区事件绑定
const $qTop = document.getElementById('q-top');
const $clearBtnTop = document.getElementById('clearBtnTop');
$qTop.addEventListener('input', ()=>{ state.q = $qTop.value; syncSearchInputs(); render(); });
$clearBtnTop.onclick = ()=>{ $qTop.value=''; state.q=''; syncSearchInputs(); render(); };

// 保持两个搜索框同步
function syncSearchInputs() {
  document.getElementById('q').value = state.q;
  document.getElementById('q-top').value = state.q;
}

// 原侧栏搜索区事件绑定改为同步
document.getElementById('q').addEventListener('input', ()=>{ state.q = document.getElementById('q').value; syncSearchInputs(); render(); });
document.getElementById('clearBtn').onclick = ()=>{ document.getElementById('q').value=''; state.q=''; syncSearchInputs(); render(); };

// 键盘快捷键
window.addEventListener('keydown', e=>{
  if(e.key === '/'){ e.preventDefault(); $q.focus(); }
  if(['c','f'].includes(e.key)){
    const first = $list.querySelector('.item .actions button');
    if(!first) return;
    const id = first.getAttribute('data-idx');
    const item = DATA.find(d=>d.id===id);
    if(e.key==='c'){ navigator.clipboard.writeText(item.syntax); }
    if(e.key==='f'){ toggleFav(id); render(); }
  }
});

// 初次渲染
renderCats();
render();
</script>
</body>
</html>
